<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VapiCoin</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- ========== TOP BAR ========== -->
  <div class="top-bar">
    <div class="top-col">👤 <span id="user-name">...</span></div>
    <div class="top-col">
      <div>IDR: <span id="idr">0</span></div>
      <button id="cairkan-btn" onclick="Exchange.tampilkanFormTukar()">Tarik Uang Otomatis 💸</button>
    </div>
    <div class="top-col">XP: <span id="xp">0</span></div>
    <div class="top-col">COIN: <span id="coins">0</span></div>
  </div>

  <!-- ========== LOGIN FORM ========== -->
  <div id="login-form" style="display: none;">
    <input type="text" id="input-name" placeholder="Masukkan Nama Anda" />
    <button id="submit-name">Mulai</button>
  </div>

  <!-- ========== LOGO + XP HEADER ========== -->
  <div class="logo">
    <h1>VapiCoin</h1>
    <div class="xp-header">
      <span class="level-label">Lv.<span id="level">1</span></span>
      <div id="xp-bar-container">
        <div id="xp-bar" data-percent="0"></div>
      </div>
    </div>
  </div>

  <!-- ========== VIDEO BAYI & TAP HINT ========== -->
  <div id="character-wrapper">
    <video id="baby-video" autoplay loop muted onclick="Game.interaksiVideo(event)" playsinline>
      <source src="videos/baby-dance.webm" type="video/webm" />
      Video tidak didukung.
    </video>
    <img id="tap-hand" src="images/tap-hand.png" alt="Tap hint" />
  </div>

  <!-- ========== TOMBOL AKSI ========== -->
  <div class="actions">
    <button onclick="Game.putarDadu()">Putar Dadu 🎲</button>
    <button onclick="Game.bagiKoin()">Bagikan 🔄</button>
  </div>

  <!-- ========== RIWAYAT PENARIKAN ========== -->
  <div id="riwayat"></div>

  <!-- ========== RIWAYAT USER ========== -->
  <div id="riwayat-user" class="riwayat-box">
    <h3>Riwayat Pemain</h3>
    <ul id="riwayat-user-list"></ul>
  </div>

  <!-- ========== ANIMASI KOIN & BONUS ========== -->
  <div id="coin-animation-wrapper"></div>
  <div id="bonus-coins-container"></div>
  <div id="bonus-popup" class="bonus-popup">+50 KOIN! 🎁</div>

  <!-- ========== SUARA ========== -->
  <audio id="coin-sound" src="sounds/coin.wav" preload="auto"></audio>
  <audio id="laugh-sound" src="sounds/baby-laugh.wav" preload="auto"></audio>

  <!-- ========== MODAL IKLAN ========== -->
  <div id="ads-modal" class="modal">
    <div class="modal-content">
      <p>🎥 Tonton iklan ini sebelum tarik uang</p>
      <button onclick="Exchange.iklanSelesai()">Saya sudah menonton</button>
    </div>
  </div>

  <!-- ========== ADMIN TOOLS ========== -->
  <div id="admin-tools" style="text-align:center; margin:20px; display:none;">
    <input type="password" id="admin-kode" placeholder="Masukkan kode admin" />
    <button onclick="Exchange.resetSemua(document.getElementById('admin-kode').value)">🔁 Reset Semua Data</button>
  </div>

  <!-- ========== SCRIPT ========== -->
  <script src="config.js"></script>
  <script src="wallet.js"></script>
  <script src="exchange.js"></script>
  <script src="game.js"></script>
  <script src="auth.js"></script>
  <script src="bonus-harian.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      Exchange.tampilkanRiwayat();
      BonusHarian.cekDanKlaim();
      Auth.cekLoginOtomatis();
      tampilkanRiwayatUser();
    });

    // Ctrl+R lalu A untuk buka admin tools
    document.addEventListener("keydown", (e) => {
      if (e.ctrlKey && e.key.toLowerCase() === "r") {
        document.addEventListener("keydown", (e2) => {
          if (e2.key.toLowerCase() === "a") {
            document.getElementById("admin-tools").style.display = "block";
          }
        }, { once: true });
      }
    });

    // Riwayat user dari backend
    function tampilkanRiwayatUser() {
      fetch('/api/users')
        .then(res => res.json())
        .then(users => {
          const list = document.getElementById('riwayat-user-list');
          list.innerHTML = '';
          users.slice().reverse().forEach(user => {
            const li = document.createElement('li');
            li.textContent = `${user.nama} • 💰 ${user.coins} • XP ${user.xp} • Lv ${user.level}`;
            list.appendChild(li);
          });
        })
        .catch(err => console.error('Gagal ambil riwayat:', err));
    }
  </script>
</body>
</html>
